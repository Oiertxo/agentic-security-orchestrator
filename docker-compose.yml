services:
  orchestrator:
    build:
      context: .
      dockerfile: services/orchestrator/Dockerfile
    container_name: orchestrator_container
    ports:
      - "8000:8000"
    volumes:
      - ./src:/app/src
      - ./data/logs:/data/logs
    environment:
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
      - MODEL_NAME=hermes3
    extra_hosts:
      - "host.docker.internal:host-gateway"
    cap_drop:
      - NET_RAW
    networks:
      - mgmt_net

  kali-engine:
    build:
      context: .
      dockerfile: services/recon-engine/Dockerfile
    container_name: kali-tools-container
    cap_add:
      - NET_RAW
    networks:
      mgmt_net:
      attack_net:
        ipv4_address: 10.255.255.2

  vuln-target:
    build:
      context: .
      dockerfile: services/targets/Dockerfile
    container_name: vuln-target
    expose:
      - "22"
    networks:
      attack_net:
        ipv4_address: 10.255.255.10

networks:
  mgmt_net:
    driver: bridge

  attack_net:
    driver: bridge
    internal: true
    ipam:
      config:
        - subnet: 10.255.255.0/24
          gateway: 10.255.255.1